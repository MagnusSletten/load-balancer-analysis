{
    # Optional: more verbose logs for debugging
    # debug
}

# Random load balancing (equivalent to api_rr with 'random')
:8082 {
    handle_path /calculate* {
        reverse_proxy app1:8000 app2:8000 app3:8000 app4:8000 app5:8000 {
            lb_policy random
            # Optional: health checks, timeouts, etc.
        }
    }

    log {
        output file /var/log/caddy/random.log
        format single_field common_log
    }
}

# Least-connections load balancing (equivalent to api_lc)
:8083 {
    handle_path /calculate* {
        reverse_proxy app1:8000 app2:8000 app3:8000 app4:8000 app5:8000 {
            lb_policy least_conn
        }
    }

    log {
        output file /var/log/caddy/least_conn.log
        format single_field common_log
    }
}
